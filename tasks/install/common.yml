---
# Install tasks common to all distros

- block:
    - name: remove obsolete docker packages
      package:
        name: "{{ item }}"
        state: absent
      with_items: >-
        {{ docker_engine_obsolete_packages[distro_packages_key]
           | default([]) }}
      tags:
        - role::docker_engine
        - role::docker_engine::packages
        - role::docker_engine::install

    - name: install docker packages
      package:
        name: "{{ item }}"
        state: present
      with_items: >-
        {{ docker_engine_packages[distro_packages_key]
           | default([]) }}
  vars:
    distro_packages_key: >-
      {{ ansible_os_family | lower + "_" + ansible_distribution_major_version }}
  tags:
    - role::docker_engine
    - role::docker_engine::packages
    - role::docker_engine::install
